<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">

      <h2 class="h5 mb-4">新着通知一覧</h2>

      <!-- トピック関連通知 -->
      <h4 class="h6 mt-4 mb-2 d-flex align-items-center justify-content-between">
        <span>参加コミュニティ新着通知</span>
        <%= button_to '一括既読', batch_update_public_notifications_path(type: "topic"), method: :patch, class: 'btn btn-outline-primary btn-sm', data: { confirm: 'この欄の通知を全て既読にします。よろしいですか？' } if @topic_notifications.any?(&:readable_in_batch?) %>
      </h4>
      <% if @topic_notifications.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col" class="text-nowrap">日時</th>
                <th scope="col">トピック名</th>
                <th scope="col">内容</th>
                <th scope="col" class="text-end"></th>
              </tr>
            </thead>
            <tbody>
              <% @topic_notifications.each do |notification| %>
                <tr>
                  <td class="text-nowrap">
                    <% ymd = notification.created_at.in_time_zone(Time.zone).strftime('%Y/%m/%d') %>
                    <% hm  = notification.created_at.in_time_zone(Time.zone).strftime('%H:%M') %>
                    <%= ymd %>
                    <br>
                    <small class="text-nowrap"><%= hm %></small>
                  </td>
                  <td>
                    <% topic = notification_topic(notification) %>
                    <% if topic %>
                      <%= link_to notification_topic_title(notification), notification_topic_path(notification), class: "text-decoration-none" %>
                    <% else %>
                      <span class="text-muted">(トピック情報なし)</span>
                    <% end %>
                  </td>
                  <td>
                    <%= notification_message(notification) %>
                  </td>

                  <td class="text-end" style="white-space: nowrap;">
                    <%= link_to '表示＆既読', notification_path(notification), method: :patch, class: 'btn btn-sm btn-primary text-white' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <div class="d-flex justify-content-center mt-2">
          <%= paginate @topic_notifications, theme: 'bootstrap4', param_name: 'topic_page' %>
        </div>
      <% else %>
        <div class="alert alert-secondary">トピック関連の新着通知はありません。</div>
      <% end %>

      <!-- レビューコメント通知 -->
      <h4 class="h6 mt-5 mb-2 d-flex align-items-center justify-content-between">
        <span>レビューコメント通知</span>
        <%= button_to '一括既読', batch_update_public_notifications_path(type: "review_comment"), method: :patch, class: 'btn btn-outline-primary btn-sm', data: { confirm: 'この欄の通知を全て既読にします。よろしいですか？' } if @review_comment_notifications.any? %>
      </h4>
      <% if @review_comment_notifications.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col" class="text-nowrap">日時</th>
                <th scope="col">レビュー名</th>
                <th scope="col">内容</th>
                <th scope="col" class="text-end"></th>
              </tr>
            </thead>
            <tbody>
              <% @review_comment_notifications.each do |notification| %>
                <% review = notification.notifiable %>
                <tr>
                  <td class="text-nowrap">
                    <% ymd = notification.created_at.in_time_zone(Time.zone).strftime('%Y/%m/%d') %>
                    <% hm  = notification.created_at.in_time_zone(Time.zone).strftime('%H:%M') %>
                    <%= ymd %>
                    <br>
                    <small class="text-nowrap"><%= hm %></small>
                  </td>
                  <td>
                    <%= link_to (review.title || "レビュー"), review_path(review), class: "text-decoration-none" %>
                  </td>
                  <td>
                    <%= notification_message(notification) %>
                  </td>
                  <td class="text-end">
                    <%= link_to '表示＆既読', notification_path(notification), method: :patch, class: 'btn btn-sm btn-primary text-white' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <div class="d-flex justify-content-center mt-2">
          <%= paginate @review_comment_notifications, theme: 'bootstrap4', param_name: 'review_comment_page' %>
        </div>
      <% else %>
        <div class="alert alert-secondary">レビューコメントの新着通知はありません。</div>
      <% end %>

      <!-- フォロー中ユーザー新規レビュー通知 -->
      <h4 class="h6 mt-5 mb-2 d-flex align-items-center justify-content-between">
        <span>フォローユーザーの新規レビュー通知</span>
        <%= button_to '一括既読', batch_update_public_notifications_path(type: "followee_review"), method: :patch, class: 'btn btn-outline-primary btn-sm', data: { confirm: 'この欄の通知を全て既読にします。よろしいですか？' } if @followee_review_notifications.any? %>
      </h4>
      <% if @followee_review_notifications.any? %>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col" class="text-nowrap">日時</th>
                <th scope="col">レビュー名</th>
                <th scope="col">内容</th>
                <th scope="col" class="text-end"></th>
              </tr>
            </thead>
            <tbody>
              <% @followee_review_notifications.each do |notification| %>
                <% review = notification.notifiable %>
                <tr>
                  <td class="text-nowrap">
                    <% ymd = notification.created_at.in_time_zone(Time.zone).strftime('%Y/%m/%d') %>
                    <% hm  = notification.created_at.in_time_zone(Time.zone).strftime('%H:%M') %>
                    <%= ymd %>
                    <br>
                    <small class="text-nowrap"><%= hm %></small>
                  </td>
                  <td>
                    <% if review %>
                      <%= link_to (review.title || "レビュー"), review_path(review), class: "text-decoration-none" %>
                    <% end %>
                  </td>
                  <td>
                    <%= notification_message(notification) %>
                  </td>
                  <td class="text-end">
                    <%= link_to '表示＆既読', notification_path(notification), method: :patch, class: 'btn btn-sm btn-primary text-white' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <div class="d-flex justify-content-center mt-2">
          <%= paginate @followee_review_notifications, theme: 'bootstrap4', param_name: 'followee_review_page' %>
        </div>
      <% else %>
        <div class="alert alert-secondary">フォローユーザー新規レビューの通知はありません。</div>
      <% end %>

      <%= link_to 'マイページへ戻る', user_path(current_user), class: 'btn btn-outline-secondary mt-4' %>

    </div>
  </div>
</div>