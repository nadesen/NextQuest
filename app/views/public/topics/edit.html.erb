<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">トピックを編集</h1>
        <div>
          <%= link_to 'トピックに戻る', forum_topic_path(@forum, @topic), class: 'btn btn-sm btn-outline-secondary' %>
          <%= link_to 'トピック一覧に戻る', forum_topics_path(@forum), class: 'btn btn-sm btn-link' %>
        </div>
      </div>

      <% if @topic.errors.any? %>
        <div class="alert alert-danger">
          <h5 class="mb-2">入力に問題があります：</h5>
          <ul class="mb-0">
            <% @topic.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="card">
        <div class="card-body">
          <%= form_with(model: [@forum, @topic], local: true) do |f| %>

            <%# フォーラム選択（現在のフォーラムがデフォルトで選択される） %>
            <div class="mb-3">
              <%= f.label :forum_id, 'フォーラム', class: 'form-label' %>
              <%= f.collection_select :forum_id,
                                     @forums,
                                     :id,
                                     :title,
                                     { selected: (@topic.forum_id || @forum&.id) },
                                     { class: 'form-select' } %>
              <div class="form-text">トピックを移動する場合は別のフォーラムを選択してください。</div>
            </div>

            <div class="mb-3">
              <%= f.label :title, 'タイトル', class: 'form-label' %>
              <%= f.text_field :title, class: 'form-control', required: true, maxlength: 255 %>
            </div>

            <div class="mb-3">
              <%= f.label :description, '本文（説明）', class: 'form-label' %>
              <%= f.text_area :description, class: 'form-control', rows: 8 %>
            </div>

            <div class="d-flex align-items-center">
              <%= f.submit '更新する', class: 'btn btn-primary' %>
              <%= link_to 'キャンセル', forum_topic_path(@forum, @topic), class: 'btn btn-link ms-3' %>
            </div>
          <% end %>
        </div>
      </div>

    </div>
  </div>
</div>