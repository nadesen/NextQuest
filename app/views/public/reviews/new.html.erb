<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h1 class="h4 mb-4">新規レビュー作成</h1>

      <%= form_with model: @review, local: true do |f| %>
        <% if @review.errors.any? %>
          <div class="alert alert-danger">
            <ul class="mb-0">
              <% @review.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="mb-3">
          <%= f.label :platform_id, 'プラットフォーム', class: 'form-label' %>
          <%= f.select :platform_id, options_from_collection_for_select(@platforms, 'id', 'name', @review.platform_id), { include_blank: '選択してください' }, class: 'form-select' %>
        </div>

        <div class="mb-3">
          <%= f.label :genre_id, 'ジャンル', class: 'form-label' %>
          <%= f.select :genre_id, options_from_collection_for_select(@genres, 'id', 'name', @review.genre_id), { include_blank: '選択してください' }, class: 'form-select' %>
        </div>

        <div class="mb-3">
          <%= f.label :title, 'ゲームタイトル', class: 'form-label' %>
          <%= f.text_field :title, class: 'form-control' %>
        </div>

        <div class="mb-3">
          <%= f.label :rating, '評価', class: 'form-label' %>
          <%= f.hidden_field :rating, id: :review_star, class: 'form-control' %>
          <div id="post_raty"></div>
        </div>

        <div class="mb-3">
          <%= f.label :play_time, 'プレイ時間', class: 'form-label' %>
          <%= f.text_field :play_time, class: 'form-control', placeholder: '例: 10時間の場合は 10 と記載してください。' %>
        </div>

        <div class="mb-3">
          <%= f.label :content, 'レビュー内容', class: 'form-label' %>
          <%= f.text_area :content, class: 'form-control', rows: 8 %>
        </div>

        <div class="d-flex justify-content-between">
          <%= link_to 'キャンセル', reviews_path, class: 'btn btn-secondary' %>
          <%= f.submit '作成', class: 'btn btn-primary' %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
$(document).on('turbolinks:load', function() {
  var elem = document.querySelector('#post_raty');
  if (elem == null) return;

  elem.innerHTML = "";
  var opt = {
    starOn: "<%= asset_path('star-on.png') %>",
    starOff: "<%= asset_path('star-off.png') %>",
    starHalf: "<%= asset_path('star-half.png') %>",
    scoreName: 'review[rating]',
    half: true
  };
  raty(elem, opt);
});
</script>