<h5 class="mb-3">コメント一覧</h5>
<table class="table">
  <tbody>
    <% review.review_comments.each do |comment| %>
      <tr>
        <td>
          <% if comment.respond_to?(:user) && comment.user.present? %>
            <%= link_to h(comment.author_name), user_path(comment.user) %>
          <% elsif comment.respond_to?(:author) && comment.author.present? %>
            <%= link_to h(comment.author_name), user_path(comment.author) %>
          <% else %>
            <span class="text-muted"><%= h(comment.author_name) %></span>
          <% end %>

          <div class="small text-muted mt-1"><%= comment.created_at.in_time_zone(Time.zone).strftime('%Y/%m/%d %H:%M') if comment.created_at %></div>
        </td>
        <td>
          <!-- 感情分析スコアを表示（comment.score を参照） -->
          <% if current_user.respond_to?(:admin?) && current_user.admin? %>
            <% if comment.respond_to?(:score) && comment.score.present? %>
              <span class="sentiment-score small text-muted d-block mb-2">
                コメント感情分析スコア: <%= comment.score %>
              </span>
            <% end %>
          <% end %>

          <div><%= simple_format(h(comment.comment)) %></div>
        </td>
        <td>
          <% if comment.user == current_user %>
            <%= link_to "削除", review_review_comment_path(review, comment), method: :delete, class: "btn btn-danger", remote: true, data: { confirm: '本当に削除しますか？' } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>