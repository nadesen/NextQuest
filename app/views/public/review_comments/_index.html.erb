<h5 class="mb-3">コメント一覧</h5>

<% total_comments =
     if defined?(@review_comments) && @review_comments.respond_to?(:total_count)
       @review_comments.total_count
     elsif defined?(@review_comments) && @review_comments.respond_to?(:total_entries)
       @review_comments.total_entries
     else
       @review_comments.size
     end %>
<div class="mb-2 small text-muted">全 <%= total_comments %> 件</div>

<table class="table">
  <tbody>
    <% @review_comments.each do |comment| %>
      <tr>
        <td>
          <% if comment.respond_to?(:user) && comment.user.present? %>
            <%= link_to h(comment.author_name), user_path(comment.user) %>
          <% elsif comment.respond_to?(:author) && comment.author.present? %>
            <%= link_to h(comment.author_name), user_path(comment.author) %>
          <% else %>
            <span class="text-muted"><%= h(comment.author_name) %></span>
          <% end %>
          <div class="small text-muted mt-1"><%= comment.created_at.in_time_zone(Time.zone).strftime('%Y/%m/%d %H:%M') if comment.created_at %></div>
        </td>
        <td>
          <% if current_user.respond_to?(:admin?) && current_user.admin? %>
            <% if comment.respond_to?(:score) && comment.score.present? %>
              <span class="sentiment-score small text-muted d-block mb-2">
                コメント感情分析スコア: <%= comment.score %>
              </span>
            <% end %>
          <% end %>
          <div><%= simple_format(h(comment.comment)) %></div>
        </td>
        <td>
          <% if comment.user == current_user %>
            <%= link_to "削除", review_review_comment_path(review, comment), method: :delete, class: "btn btn-danger", remote: true, data: { confirm: '本当に削除しますか？' } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%# ページネーション %>
<% if @review_comments.respond_to?(:total_pages) && @review_comments.total_pages > 1 %>
  <div class="d-flex justify-content-center mt-2">
    <%= paginate @review_comments, param_name: 'review_comments_page', theme: 'bootstrap4' %>
  </div>
<% end %>