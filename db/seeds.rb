# == 管理者アカウント ==
Admin.find_or_create_by!(email: "admin@example.com") do |admin|
  admin.password = "password"
  admin.password_confirmation = "password"
end

# == 固定値データ ==
platform_names = %w[
  PC Swotch2 Swotch WilU Wil ゲームチューブ SFC PS5 PS4 PS3 PS2 PS スマホゲーム その他ゲーム機器
]

genre_names = [
  "RPG(ロールプレイングゲーム)",
  "アクションゲーム",
  "アドベンチャーゲーム",
  "シミュレーションゲーム",
  "ストラテジーゲーム",
  "レースゲーム",
  "リズムゲーム",
  "ホラーゲーム",
  "シューティングゲーム",
  "テーブルゲーム"
]

forums_data = [
  {title: "雑談", description: "自分のお気に入りゲームについて会話してみましょう!!"},
  {title: "攻略", description: "ゲームについての攻略情報コミュニティです。"},
  {title: "質問", description: "何かゲームで質問があればコミュニティで聞いてみましょう!!"},
  {title: "要望・提案", description: "ゲームの要望・提案を考えてみましょう。ゲーム開発者が見てくれれば儲けもの・・・"},
  {title: "バグ報告", description: "ゲームのバグについて共有しましょう。"}
]

# == プラットフォーム・ジャンル・フォーラム ==
platforms = platform_names.map { |name| Platform.find_or_create_by!(name: name) }
genres = genre_names.map { |name| Genre.find_or_create_by!(name: name) }
forums = forums_data.map { |forum| Forum.find_or_create_by!(title: forum[:title], description: forum[:description]) }

# == ユーザーデータ（サンプル20名） ==
jp_names = [
  "佐藤 遼太",      # 1
  "鈴木 美咲",      # 2
  "高橋 優斗",      # 3
  "田中 海斗",      # 4
  "渡辺 剛志",      # 5
  "伊藤 さやか",    # 6
  "山本 京介",      # 7
  "小林 夕莉",      # 8
  "中村 翔太",      # 9
  "加藤 沙羅",      # 10
  "斎藤 剛",        # 11
  "松本 音葉",      # 12
  "林 陸",          # 13
  "清水 奈緒",      # 14
  "山田 直樹",      # 15
  "池田 悠",        # 16
  "森本 都",        # 17
  "大野 雄太",      # 18
  "石井 由梨",      # 19
  "長谷川 琴音"     # 20
]

nicknames = [
  "りょうりょう",
  "misaki攻略Note",
  "ゆうとまったり",
  "KaitoFighter",
  "ごしのレトロ",
  "SayaMamaGamer",
  "きょうすけ怖がり",
  "kyosukeHorror",
  "しょータの日課",
  "ShoLogin123",
  "ごう実況みる専",
  "GoWatchLive",
  "音リズムじん",
  "otohaRhythm",
  "りくしみゅ愛好",
  "RikuSimMaster",
  "みやこころころ",
  "MiyakoComeback",
  "ゆりスト愛",
  "KotoneEduKids"
]

user_profiles = [
  "幼い頃からゲームが好きで、RPGやアクション、音楽ゲームまで幅広く楽しんでいます。最近のお気に入りは協力プレイが熱いタイトル！休日は友人とオンラインで盛り上がるのが至福です。",
  "攻略情報の発信やレビュー執筆が趣味。新作タイトルは発売日に必ずチェックし、感想をSNSに投稿しています。オフラインイベントにもよく参加します！",
  "まったり系プレイヤー。仕事終わりや寝る前に一息つくための癒やしとして、スローライフゲームやパズルゲームを楽しんでいます。たまに実況配信もしています。",
  "対人戦（PvP）が大好き！格闘ゲームを中心にランキング上位を目指して日々腕を磨いています。大会への参加経験もあり。",
  "レトロゲーム愛好家です。ファミコンやSFC時代の名作を集めて20年。思い出と共にレビューを書いています。",
  "家族みんなでワイワイ楽しめるゲームが好き。小さい子供でも遊べるタイトルを紹介する記事を書いています。親子ゲーマー。",
  "ホラーゲーム・謎解きゲーム特化。怖いけどやめられない、そんな名作を見つけるのが生きがいです。おすすめ募集してます！",
  "グラフィック・音楽・ストーリー全てをじっくり味わいたい派。美麗なRPGを中心にレビューを書いています。",
  "毎日ログインしてコツコツ型のスマホゲームを楽しんでいます。ガチャやイベント攻略のアドバイスも書いています。",
  "レビューよりもコミュニティでみんなと会話するのが楽しみ。ゲームの話題なら何でも大歓迎！",
  "ゲーム実況もたまにしているライトゲーマー。気になるタイトルはすぐに手を出し、その勢いでレビューを投稿しています。",
  "音ゲー命！新曲フルコンボを目指し、ハイスコア更新に燃えています。音楽ゲームの魅力を伝えたいです。",
  "シミュレーションゲーム専門。歴史・経営・都市作り系が大好物。じっくり時間をかけてプレイ、丁寧にレビューします。",
  "ゲーム内でフレンドを作るのが得意。初心者の手助けやギルド運営にも積極的です。みんなでワイワイ派。",
  "新作インディーゲーム漁りが趣味。毎週新しいゲームを買うのを楽しみにしています。意外な名作を発掘して紹介しています。",
  "自作ゲーム開発者。裏方としての視点でレビューや改善点を指摘しています。開発者同士の交流も大事にしています。",
  "懐かしの名作を再プレイして発見した新たな魅力を語っています。昔の思い出と共にレビューを書けるのが幸せ。",
  "家族と協力・対戦できるパーティーゲームに目がないです。親戚が集まったときはいつもゲーム大会！",
  "RPGでストーリーを深く楽しむ派。感動したシーンやキャラクターの魅力を語る長文レビューに定評があります。",
  "子どもたちと一緒に楽しめるゲームを探しています。教育的な要素やコミュニケーションが取れるゲームを中心に遊んでます。"
]

user_count = 20
users = []
user_count.times do |i|
  # i=0が一番古い、i=19が今日
  # 1年をuser_count等分して、さらに±数日のランダムを混ぜる
  base_time = (1.year * (user_count - 1 - i) / (user_count - 1)) # 秒数で
  # ±7日程度の小ランダム追加
  ripple = rand(-7.days..7.days)
  created = Time.current - base_time + ripple

  users << User.create!(
    name: jp_names[i],
    nickname: nicknames[i],
    email: "example#{i}@example.com",
    password: "example#{i}",
    password_confirmation: "example#{i}",
    profile_text: user_profiles[i],
    suspended: false,
    created_at: created
  )
end

require 'securerandom'

# --- プラットフォーム・ジャンルのセットアップ ---
platforms = Platform.all.to_a
genres    = Genre.all.to_a
users     = User.all.to_a

# --- ゲームタイトルネタ ---
game_titles = [
  "星降る冒険譚サンクタリウム",
  "ミラージュ・クロノス",
  "孤島のリミナリス",
  "レゾナンス・オブ・ダークネス",
  "セレスティアの誓約",
  "ウィッチズ・オルゴール",
  "機巧兵団スチームギア",
  "ダイブ・トゥ・マナリア",
  "クローバー・ラビリンス",
  "エターナル・ソーン",
  "銀嶺のソードマスター",
  "フェイブル・コンチェルト",
  "幻影探偵シャドウコード",
  "アルカナ・ルーレット",
  "暁のインビジブル",
  "サモナーズ・フロンティア",
  "ドリームシフターズ",
  "マグネット・インサニティ",
  "ジオラマ・ジェネシス",
  "ノクターン・デスペランサ",
  "ブラックサイト：ラグランジュ",
  "ワンダースフィア・クエスト",
  "ラストシーカー：転生の書",
  "ヴァルハラ・ブレイブリー",
  "オメガリフト・サーガ"
]

# --- レビュー本文（200文字以上でバリエーション豊富に） ---
review_bodies = [
  "本作は壮大なファンタジーワールドを見事に構築しており、ストーリー演出やキャラクター同士の細やかな交流が素晴らしい。グラフィックやBGMも要所で場面を盛り上げ、冒険心を思い出させてくれる作品。バトルは戦略性が高く、仲間キャラとの連携を考える楽しみがある。物語終盤はプレイヤーの選択で結末が大きく変化し、何度も周回したくなる中毒性も魅力。",
  "本作にはリアルタイムバトルとアドベンチャー要素が融合しており、初めは手応えの強さに圧倒されますが、慣れると奥深い戦略性に魅了されました。物語も王道ながら意外な展開もあり、一気にクリアしてしまいました。マルチエンディングのおかげで、周回プレイも飽きません。特にエンディング選択前の伏線回収が秀逸です。",
  "タイムトラベルをテーマにした物語で、ゲーム全体に漂う不思議な雰囲気がクセになる。謎解き要素も盛り込まれており、先の読めない展開に夢中でプレイしてしまった。グラフィックは近未来的で洗練されているが、一部操作性で戸惑う場面も。ボリュームも十分で、エンディング後に解放されるサブクエストも豊富。トータルで満足度の高い一本。",
  "孤島でサバイバル生活を送りながら少しずつ真相に迫っていく展開が秀逸。緻密な資源管理や、島民との交流イベントがゲーム進行の鍵を握る。サブキャラクターも個性的で飽きさせない。グラフィックはやや素朴だがBGMが心地良い。探索好きにも満足できる隠しエリアやミニゲームもあり、何度もプレイしたくなる。",
  "本格ダークファンタジーRPG。魔物との緊張感あるバトルと重厚な世界観が印象的だった。主人公が背負う運命や仲間たちのドラマにも引き込まれ、物語を追うだけでも夢中になってしまう。一部UIにわかりにくさを感じたが、やり込み要素やチャレンジモードもあり、長く楽しめる一作。",
  "空に浮かぶ王国を舞台に、謎に包まれた伝説を紐解いていくシナリオが見事。キャラクターボイスや演出も凝っており、物語の没入感はシリーズ随一。ボス戦の難易度はやや高めだが、クリアしたときの達成感は格別。サブイベントやミニゲーム要素も充実していて、つい全実績を集めたくなる。",
  "魔女が奏でる不思議な旋律がテーマの一風変わったパズルアドベンチャー。技巧的なパズルが連続するが理不尽ではなく、クリア時の達成感が気持ちいい。ビジュアルや音楽も独創的で雰囲気抜群。ストーリーは控えめながら深読みが可能で、余韻が残るラストシーンも印象的。",
  "スチームパンク世界での大規模戦が楽しいシミュレーションゲーム。ユニットの育成や装備集め、マップ戦略の幅が非常に広く、自分だけの軍隊を作る喜びがある。オンライン要素ではプレイヤー同士の知略対決も白熱。操作に少し慣れが必要だが、ハマるとやめ時が見つからない中毒性がある。",
  "魔力に溢れる大地を舞台に、ダイブして冒険するアクションRPG。多彩なスキルや装備切り替えが可能で、戦闘のテンポも良い。ストーリーもテンポよく進み、寄り道要素やキャラの掘り下げイベントも魅力。派手なエフェクトが多用されているが動作は軽快。一気にクリアしてしまう面白さがあった。",
  "かわいいクローバーを集めて進む迷宮探索ゲーム。パズル要素もあり、頭を悩ませる仕掛けが随所に登場する。グラフィックはポップで親しみやすく、子供から大人まで楽しめる。協力プレイでは家族や友人とワイワイ盛り上がった。本編クリア後のチャレンジステージも歯ごたえ抜群。",
  "ダークファンタジーにSFの要素が加わった特殊なRPG。物語や世界観が独特で、好みが分かれるかもしれないが刺さる人にはとことん刺さる作品。バトルの難易度は高めで、繊細な育成が求められる。ストーリーの謎解き要素も奥深かった。クリアまで30時間以上かかったが、その分の満足感は大きい。",
  "氷に覆われた世界を舞台に、剣士として生き残りをかけるサバイバル＆バトルゲーム。仲間キャラの成長や武器カスタマイズが楽しい。マルチエンドに対応しており、何度も遊びたくなる要素満載。グラフィックは超美麗で、音楽も壮大だった。雪原の中で見つけた隠しシナリオが涙ものでした。",
  "音楽と謎解きを融合させた新感覚アドベンチャー。随所に散りばめられた楽曲やBGMがプレイ体験を彩ってくれる。操作性も直感的で遊びやすい。エンディングまであっという間だったが、その短さを感じさせない濃密な内容だった。おしゃれな演出も印象的で、癒やされたい人におすすめ。",
  "ハードボイルドな雰囲気漂う探偵物。ストーリー展開のスピードや選択肢の多さが魅力的。登場人物の背景も複雑で、考察好きにはたまらない。推理パートの難易度は適度。グラフィックも独特で、少しクセはあるが没入感は強い。エンディング分岐も豊富で長く遊べる。",
  "カードゲームとサイコロを融合した斬新なルールが印象的。高速で展開するバトルが癖になる。カード集めやデッキ構築も楽しみつつ、運要素と戦略性のバランスが絶妙。ローカル対戦も盛り上がった。短い時間でさくっと遊べるが極め出すと奥が深く、やり込んでしまう。",
  "ステルスアクションが得意なプレイヤーにおすすめしたい一作。夜の都市を舞台に、様々なギミックを駆使して任務を遂行。敵AIが賢く、毎回異なる攻略パターンを考える楽しさがある。グラフィックも暗めで雰囲気重視。難易度は高めだが達成感が大きい。",
  "召喚獣たちと契約し、世界を救うべく冒険するRPG。壮大なストーリーや個性豊かな仲間たちのやり取り、迫力満点の召喚バトル。物語のテンポも良く、サブイベントも豊富。本編をクリアした後もやり込める要素が多い。定期的にイベント追加もあるみたい。",
  "夢の中の世界を旅するアドベンチャー。ユニークなキャラクターや不可思議な空間が連続し、飽きずに進められる。謎解きも斬新で視覚的な演出も多彩。ストーリー展開はやや難解だったが、自分で解釈できる楽しさがあった。操作性は良好で、全体的に高評価。",
  "磁石をテーマにした物理パズルアクション。ギミックのユニークさと操作の直感性が光る。各ステージごとに新しいアイディアが投入され、最後まで飽きずに楽しめた。難易度の上昇バランスも絶妙。タイムアタック要素も充実しているので、繰り返し遊ぶ楽しさがあった。",
  "街づくりと経営シミュレーションが合体した新感覚タイトル。建物や資源の配置バランスを見極める戦略性が奥深い。キャラクターの生活も観察できて癒やされる。難易度は程よく、初心者から上級者まで長く遊べる印象。BGMも穏やかでプレイ中のストレスが少ない。",
  "夜の都市で繰り広げられるサスペンス・ノベルゲーム。複数視点で語られるストーリーの重厚さに引き込まれた。選択肢によって分岐する展開が緊張感あり。BGMや演出も雰囲気抜群で、何度もエンディングを目指してしまう。",
  "異世界転生シミュレーションとして革新的な作品。サブイベントの豊富さや、自由度の高い育成がとても楽しい。UIデザインも見やすく長時間プレイしても疲れません。エンディングルートの多さには驚きました。",
  "協力マルチプレイでの連携が勝敗を左右する斬新なバトルシステム。フレンドと一緒にプレイすることで楽しさ倍増です。独自のマッチング機能もストレスフリーで快適でした。初心者でも安心して入れる設計。",
  "ノスタルジックなドット絵と現代的なシステムが絶妙に融合する冒険譚。登場キャラの背景設定が深く、共感できるストーリー展開でした。ちょっとした不満点もあるが、それすら味に感じる名作。",
  "リアルタイムストラテジーとしての完成度が高い。緻密なマップ設計やユニットバランスが絶妙です。世界中のプレイヤーと対戦することで、自分の成長も感じられる良いタイトル。",
  "ストーリーと音楽の調和が心に残る感動作。グラフィックも美麗で、最後までプレイした時の充実感がすごかった。ぜひ続編を望みたい。",
  "全体的にハイクオリティ。ストーリー、キャラ、サウンド、バトルのどれを取っても平均以上。数々の名シーンが心に残る珠玉の一作。",
  "戦闘システムが独特で、慣れるまでは苦労しましたが、理解を深めるほどに面白くなりました。途中若干難易度は高いですが丁寧なチュートリアルもあり、初心者でも挑戦できる作品です。"
]

# --- レビュー星評価リスト ---
star_values = (1..10).map { |n| n * 0.5 } # 0.5, 1.0, ... 5.0
# shuffle用に事前にstar値を割り当て
star_map = game_titles.zip(star_values.shuffle).to_h

# --- プレイ時間生成用 ---
def generate_play_time_for(star, body)
  case
  when star > 4.0 then rand(45..90).to_s # 高評価＝長め
  when star > 3.0 then rand(30..50).to_s
  when star > 2.0 then rand(15..30).to_s
  when star > 1.0 then rand(5..20).to_s
  else rand(1..10).to_s
  end
end

# 1:1にするために全カテゴリシャッフル
platforms_cycle = platforms.cycle
genres_cycle    = genres.cycle

reviews = []
users.each_with_index do |user, i|
  # 各ユーザーに2件以上になるよう、バラけさせる
  n_reviews = [2, rand(3..4)].sample
  n_reviews.times do 
    # タイトル/本文一意消費
    title = game_titles.shift
    body  = review_bodies.shift
    star  = star_map[title] || star_values.sample
    play_time = generate_play_time_for(star, body)
    platform = platforms_cycle.next
    genre    = genres_cycle.next

    # ユーザーのcreated_at以降〜今日−1日まででランダムな日時を生成
    review_created_at = rand(user.created_at..(Time.current - 1.day))
    review = Review.create!(
      user: user,
      title: title,
      content: body,
      platform: platform,
      genre: genre,
      rating: star,
      star: star,
      play_time: play_time,
      approved: true,
      created_at: review_created_at
    )
    reviews << review
    break if game_titles.empty?
  end
  break if game_titles.empty?
end

# 全プラットフォーム/ジャンルが一度は選ばれているかチェック（漏れがあれば割り当てする）
remaining_platforms = platforms - reviews.map(&:platform)
remaining_genres = genres - reviews.map(&:genre)
remaining_platforms.each_with_index do |plat, idx|
  review = reviews[idx % reviews.size]
  review.update(platform: plat)
end
remaining_genres.each_with_index do |gen, idx|
  review = reviews[idx % reviews.size]
  review.update(genre: gen)
end

# --- レビューコメント ---
review_comment_bodies = [
  { body: "主人公のキャラクター性が最高！ストーリーに感動して涙が出ました。", score: 0.9 },
  { body: "音楽とグラフィックの組み合わせが美しいです。夢中になれました！", score: 0.8 },
  { body: "戦闘が難しすぎて挫折しそう…でもやり応え充分です。", score: -0.4 },
  { body: "操作性が思ったより快適で遊びやすい。つい長時間やってしまう。", score: 0.7 },
  { body: "ストーリーが途中から難解でついていけなくなりました。人を選ぶゲームかも。", score: -0.7 },
  { body: "協力プレイでの盛り上がり方が最高！友達と遊ぶのが楽しい一本でした。", score: 1.0 },
  { body: "エンディングが予想外で驚きました。", score: 0.6 },
  { body: "一部バランス調整が甘く感じる場面があり、そこだけ惜しい。", score: -0.6 },
  { body: "サブイベントが豊富で寄り道が楽しい。", score: 0.5 },
  { body: "難易度が高く、最初は苦戦しますがクリア時の達成感は格別です。", score: 0.4 },
  { body: "アイテム収集要素がやり込み好きにはたまりません。", score: 0.3 },
  { body: "グラフィックはやや粗いけど内容は良作です。", score: 0.2 },
  { body: "説明不足な点が多く初心者には少し難しいかも。", score: -0.8 },
  { body: "ストレス発散に最適な爽快アクションでした！", score: 0.9 },
  { body: "オンライン要素があればもっと楽しめたと思う。", score: -0.5 },
  { body: "ロード時間が長い点が唯一残念。", score: -0.9 },
  { body: "キャラどうしの会話が面白く物語にのめりこめました。", score: 0.5 },
  { body: "新規プレイヤーにも優しい設計で好印象です。", score: 0.8 },
  { body: "グラフィックは美しいが難しすぎて途中でやめてしまった。", score: -0.6 },
  { body: "課金しなくても十分楽しめる良心的なゲームです。", score: 0.6 },
  { body: "アップデートごとにバランスが崩れてしまう。", score: -0.7 },
  { body: "エンドロールで泣いてしまいました。", score: 0.8 },
  { body: "音楽が耳に残る名曲揃いです。サントラ欲しい。", score: 0.7 },
  { body: "コミュニティの雰囲気がとても良いので長く続けられそうです。", score: 1.0 },
  { body: "良いアイディアだが実装が甘い印象を受けた。", score: -0.3 },
  { body: "いろいろなイベントが用意されていて嬉しい。", score: 0.4 },
  { body: "バトルのシステムが単調で飽きてしまった。", score: -0.5 },
  { body: "ゲームを通して友達が増えた！", score: 0.6 },
  { body: "バグが多くてイライラした。", score: -1.0 },
  { body: "やり込み要素が多く、長く楽しめるのが良いです。", score: 0.8 },
  { body: "ストーリーに深みがあり大人も楽しめる作品。", score: 0.7 },
  { body: "最初の難関を乗り越えれば楽しくなってくる。", score: 0.3 },
  { body: "キャラクターの台詞がネタっぽく好みに合わなかった。", score: -0.2 },
  { body: "ユーザーインターフェースが直感的で使いやすい。", score: 0.5 },
  { body: "エラー落ちが頻発したのが残念だった。", score: -0.9 },
  { body: "ラスボス直前で詰んだけど、攻略情報のおかげで無事クリア。", score: 0.4 },
  { body: "アップデートで新機能が増えさらに面白くなりました。", score: 0.6 },
  { body: "ストーリーは良いけど、戦闘のテンポが悪かった。", score: -0.4 },
  { body: "吹き替え声優が豪華で聴きごたえがある。", score: 0.6 },
  { body: "操作説明が雑で最初は苦戦した。", score: -0.8 },
  { body: "昔懐かしい雰囲気で童心に帰れる作品！", score: 0.9 },
  { body: "全体的に難易度が高めだと感じました。", score: -0.5 }
]

reviews.each do |review|
  comment_bodies_sample = review_comment_bodies.shuffle.take(5)
  # 必ずポジティブ/ネガティブ両方入るようにする
  pos_comment = review_comment_bodies.select{|h| h[:score] > 0}.sample
  neg_comment = review_comment_bodies.select{|h| h[:score] < 0}.sample
  comments_src = ([pos_comment, neg_comment] + comment_bodies_sample).uniq.first(5)
  used_users = ([review.user] + users).uniq.shuffle.first(6)
  comments_src.each_with_index do |comment_info, idx|
    commenter = (used_users - [review.user]).sample
    # レビューのcreated_at以降〜今日−12時間まででランダムな日時を生成
    comment_created_at = rand(review.created_at..(Time.current - 12.hours))
    c = ReviewComment.create!(
      user: commenter,
      review: review,
      comment: comment_info[:body],
      score: comment_info[:score],
      created_at: comment_created_at
    )
    # ポジティブなら「いいね」＆作成者をフォロー
    if comment_info[:score] > 0
      Like.find_or_create_by!(user: commenter, likeable_id: review.id)
      if commenter != review.user
        Follow.find_or_create_by!(follower: commenter, followed: review.user)
      end
    end
    used_users.delete(commenter)
  end
end

# == トピック・ポスト生成 ==================
topic_title_samples = [
  # 1: ゲームの感想・思い出系
  "最近プレイして一番感動したゲームは？",
  "今までやった中で最も難しかったタイトルは？",
  "人生で一番泣いたRPGシーンを語ろう",
  "友達と昔ハマった思い出のゲームとは？",
  "今でも忘れられない名セリフを挙げて！",
  "心に残るバッドエンド作品",
  "学生時代周回プレイを繰り返したタイトル",
  "リア友・家族を巻き込んだ伝説の協力プレイ",
  "好きだったエンディング曲・BGMを語る",
  "ゲーム内で一番爆笑したイベント・会話",
  # 2: 推しキャラ・ランキング・趣味語り
  "星降る冒険譚サンクタリウムの推しキャラ談義",
  "ミラージュ・クロノスで絶対外せないキャラは？",
  "「このゲーム」強キャラランキング",
  "推したい職業・種族・クラス談義",
  "お気に入りのコスチューム・衣装紹介",
  "好きな武器タイプランキング",
  "サモナー＆召喚獣で一番使った仲間は？",
  "好きなライバル・敵ボス 2024",
  "このゲームに出てほしかったコラボキャラ",
  "キャラカードコレクションで一番苦労した話",
  # 3: 攻略・ハプニング系
  "ノクターン・デスペランサの序盤攻略TIPS",
  "詰まりやすい謎解きスポットまとめ",
  "クリアに役立つ小ネタ・裏技共有しませんか？",
  "マルチプレイで遭遇した珍事件ランキング",
  "絶叫バグ体験・面白バグ投稿トピック",
  "高難易度ボスに挑むメンバー募集",
  "ダイブ・トゥ・マナリア：魔法の最強組み合わせ発見談",
  "絶体絶命のピンチから勝てた秘策とは？",
  "効率良い経験値稼ぎ・レベル上げ技まとめ",
  "新作アップデートで変わったこと情報交換",
  # 4: 質問・投票・相談・アンケート系
  "初心者歓迎：最初に困ったことは？",
  "最強キャラって本当に○○？みんなの推し教えて",
  "好きな難易度・ゲーム設定は？",
  "どのプラットフォーム派？世代比較トーク",
  "迷っているストーリー分岐どっち選んだ？",
  "フレンド募集トピック2024春",
  "みんなの一番よく使うアイテムは？",
  "攻略チャート派or手探り派？アンケ―ト",
  "バトルに勝てない時どうしてる？",
  "今一番注目してる新作タイトル",
  # 5: バグ・システム・裏話系
  "このゲームで一番笑ったバグ画像",
  "運営さんに問い合せたことある？その経緯とは",
  "ロードが遅い時の対処法",
  "課金と無課金 どちらが楽しめる？",
  "「この公式コラボ最高だった！」を語ろう",
  "ギルド活動の裏話や失敗談",
  "気になったアプデ仕様、みんなの感想",
  "ストーリー分岐でバグった時の再現方法",
  "ガチャ天井・ガチャ確率の体感",
  "ファーストインプレッションはどんなだった？",
  # 6: 投稿募集＆遊び心系
  "プレイ中の面白スクショ投稿所",
  "高難易度クリア記念・自慢トピ",
  "思い出タイトルCMパロディ創作大会",
  "ミニイベント＆大規模大会の感想募集",
  "二次創作・ファンアート自慢トピ",
  "お勧め推理ゲームクイズ投稿トピ",
  "隠しコマンド集、語ってみよう",
  "復刻してほしい限定キャライベント",
  "レア称号所持者集まれ！",
  "好きなゲームジャンル四天王 決定戦"
]

topic_desc_ideas = [
  # 感想・共感・ストーリー
  "感動した場面や心を動かされたエピソードについて自由に語りましょう。",
  "難しかった箇所や思い出の名シーンについて、みんなで共有しませんか？",
  "泣けるエピソードや悲しい展開があればぜひ教えてください。",
  "昔ハマったゲームや家族・友達との思い出を振り返るトピックです。",
  "印象的だった名セリフやキャラクターの言葉を語り合いましょう。",
  "衝撃のバッドエンド体験・感想をシェアしよう。",
  "周回プレイで面白かった思い出話・やり込み体験を募集します。",
  "協力プレイで大盛り上がりしたエピソードを交換する場です。",
  "好きなゲーム音楽やBGMの思い出、どの曲が良かった？を語ろう。",
  "思わず笑ったイベントや会話エピソードをお気軽に投稿してください。",
  # 推しキャラ・ランキング
  "推しキャラの魅力や育成論をたっぷり語るトピック！好きなキャラを自慢しよう！",
  "こだわりのキャラ選び、運用のコツや工夫をシェア！",
  "歴代で一番強い・使いやすいキャラをランキング形式で語ろう。",
  "あなたが推したい職業・役割・種族への愛をアツく語ってください。",
  "お気に入りコスチューム・見た目装備などを画像付きで紹介！",
  "好きな武器種や武器性能について熱く語り合いましょう。",
  "召喚獣やペット仲間の育成談義・使える組み合わせ募集中。",
  "印象的だったライバルや宿敵キャラについて語る場所です。",
  "他作品コラボへの期待や「このキャラ出てほしい！」願望を熱く語らおう。",
  "カードコレクションやガチャ苦労話・レアカード自慢、なんでもOK！",
  # 攻略・ハプニング
  "序盤～クリア後の攻略TIPS、迷ったポイントを気軽に聞き合える場所。",
  "詰まりやすい謎解きや難問ギミック体験談を共有しませんか？",
  "クリアに役立った裏技や小ネタ情報を大募集します！",
  "マルチプレイで遭遇した珍事件や奇跡の展開を投稿！",
  "面白バグ・絶叫バグ体験記を気軽に報告してください。",
  "高難易度ボスの攻略法・討伐メンバー募集用トピック。",
  "理想的なスキル・装備の組み合わせや発見談を教えてください！",
  "ピンチからの逆転劇体験談をシェアしましょう！",
  "効率重視の経験値稼ぎや育成テクニック交換所。",
  "新アップデートで感じた違いや感想を語り合う場。",
  # Q&A・アンケート系
  "初心者歓迎！最初に悩んだ点や役立った情報を集めましょう。",
  "最強キャラ・パーティ編成について教え合いませんか？",
  "みんなが好む難易度やゲーム設定ポイントをアンケ―ト！",
  "好きなプラットフォームやハードに関する雑談トピ。",
  "ストーリー分岐で迷った箇所・選択肢の相談所。",
  "新たなフレンド・ギルド仲間を募集するための部屋です。",
  "アイテムや装備、どこでどう使ってる？攻略共有板。",
  "自力攻略派ｖｓチャート派、あなたはどっち？アンケ―ト！",
  "バトルで苦戦した時の対策・アドバイス交換所。",
  "今期の注目ゲームや最新情報を語るお気楽掲示板。",
  # バグ・課金・運営系
  "一番ビックリしたバグ画像・体験談募集！",
  "運営対応やサポートへの問い合わせ体験を教えて。",
  "ロードが遅くなった時・改善方法の雑談トピ。",
  "課金なしでどこまで楽しめるか体験談募集中！",
  "神コラボ・理想のコラボの思い出・要望を書こう。",
  "ギルド活動の裏話やリアル友情育成エピソードを語ろう。",
  "アプデで変わった機能や仕様、良し悪しを語る場所。",
  "分岐・エンドで発生したバグや不具合の再現方法共有。",
  "ガチャ天井まで回したエピソードを大募集！",
  "初見プレイ時の印象や期待値どうだった？交流しよう。",
  # 投稿募集・お遊び系
  "あなたのベストショット・爆笑スクショ投稿会場",
  "高難易度クリア・スーパープレイ動画募集中！",
  "懐かしCM・ゲーム広告パロディ創作大歓迎！",
  "開催されたミニ・大型イベントの印象や反省会はこちら。",
  "ファンアート・二次創作を紹介したい人専用トピ。",
  "自作推理クイズ・ミニゲームアイデアの発表会。",
  "隠しコマンドや裏技をみんなで語るトピック。",
  "復刻希望イベントや限定キャンペーン要望を語ろう。",
  "レア称号や超難関実績の達成者自慢トピ",
  "好きなジャンル・シリーズで四天王を決めよう！"
]

def topic_description(title)
  idx = nil
  desc_map = {
    /感動|泣ける|名シーン|思い出|人生|爆笑|エンド/ =>
    "ゲームで心を動かされた・感動した・泣けた体験や思い出話を語るためのトピックです。思い入れのあるエピソードをみんなでシェアしよう！",
  /推しキャラ|強キャラ|最強キャラ|職業|コスチューム|装備|召喚獣|ペット|ライバル|コラボ|カード|ランキング|好きな武器|一番使/ =>
    "あなたの推しやおすすめキャラクター、最強ランキングや職業・装備・ペット・カード・コラボ等の推しポイントをアツく語り合う場所です！",
  /攻略|詰まり|ギミック|裏技|マルチ|珍事件|ボス|TIPS|テクニック|ピンチ|効率|組み合わせ|勝てた|ハプニング|クリア/ =>
    "攻略情報・豆知識・裏技やバグ・マルチプレイ珍事件・高難易度ボスに挑む経験・勝てたコツなど、ゲーム進行に役立った話題をどうぞ！",
  /初心者|Q&A|質問|困っ|相談|投票|アンケート|好む|プラットフォーム|分岐|フレンド|仲間|チャート|バトル|注目ゲーム|アイテム/ =>
    "初心者相談やQ&A、投票・アンケート、みんなが感じた素朴な疑問を語る雑談トピックです。お気軽に質問・情報交換しよう！",
  /バグ|不具合|運営|サポート|ロード|課金|無課金|コラボ|ギルド|アプデ|分岐|クレーム|不満|天井|体感|初見プレイ/ =>
    "バグ画像・不具合体験や運営・課金まわり・最新アップデート・ロードなどの裏話や意見、運営サポートへの体験談を共有するトピックです。",
  /投稿|自慢|スクショ|パロディ|ファンアート|二次創作|イベント|称号|四天王|ミニゲーム|創作|爆笑|動画|反省会|記念|クイズ/ =>
    "スクリーンショット・ファンアート・クリア自慢や面白投稿、パロディやイベント・動画・他ジャンル創作ネタを持ち寄れる遊び心満載のトピック！",
  /.*/ =>
    "ゲームに関する内容であれば何でも自由に投稿できます。あなたの経験や感じたこと、思い立ったネタや雑談などお気軽にどうぞ！"
}
  desc_map.each { |reg, v| return v if title =~ reg }
end

# タイトル候補を20*2=40以上に増やす
topic_title_pool = []
game_titles.each do |game|
  topic_title_pool << "#{game}の推しキャラ談義"
  topic_title_pool << "#{game}の思い出と語りたいこと"
  topic_title_pool << "#{game}高難易度ボス対策"
  topic_title_pool << "#{game}で一番感動したシーン"
  topic_title_pool << "#{game}の好きなシナリオ分岐"
end
topic_title_pool.concat(topic_title_samples)
topic_title_pool.shuffle!

# --- Create Topics ---
topics = []
used_titles = []
# フォーラムごとに最初に少なくとも1つは作る
forums.each do |forum|
  user = users.sample
  title = topic_title_pool.pop
  title = title.presence || "ダミータイトル"
  description = topic_description(title).to_s[0,500]
  description = description.presence || "ダミー説明文：#{title}について語りましょう。"
  created_at = [user.created_at + rand(0..14.days), Time.current - 30.days].min
  t = Topic.create!(
    forum: forum,
    creator: user,
    title: title,
    description: description,
    created_at: created_at
  )
  topics << t
  used_titles << title
end

# 各ユーザーに2個ずつ
users.each do |user|
  2.times do
    forum = forums.sample
    title = (topic_title_pool - used_titles).sample
    title = title.presence || "ダミータイトル"
    description = topic_description(title).to_s[0,500] # 500文字制限
    description = description.presence || "ダミー説明文"
    # ユーザー作成日より新しめ
    earliest = user.created_at + 1.day
    latest = Time.current - 5.days
    topic_time = rand(earliest..latest)
    t = Topic.create!(
      forum: forum,
      creator: user,
      title: title,
      description: description,
      created_at: topic_time
    )
    topics << t
    used_titles << title
  end
end

# --- コミュニティ参加メンバー割当（topic_membership） ---
topics.each do |topic|
  members = users.sample(rand(3..8))
  members.each do |member|
    # topic作成者は自動で承認
    tm_status = (member == topic.creator) ? "approved" : %w[approved pending].sample
    TopicMembership.find_or_create_by!(
      user: member,
      topic: topic,
      status: tm_status,
      created_at: [member.created_at, topic.created_at].max + rand(0..3.days)
    )
  end
end

# --- Post作成（コミュニティチャット） ---
POST_BODIES_POOL = [
  # 雑談/全般
  "みんなはどのプラットフォームで遊んでる？",
  "シリーズ未経験ですが楽しめますか？",
  "ネタバレ苦手な人、どこまでなら話OK？",
  "初心者一問一答コーナー！",
  "最初に手に入れるおすすめキャラは？",
  "アップデートごとにバランス変わるの感想どう？",
  "セーブデータが消えた悲しい思い出…",
  "ギルドで交流してる人いますか？",
  "動画配信で見て気になって始めた人いる？",
  "自分のプレイングスタイルこだわりポイント",
  "お気にスキン・衣装画像貼ります！",
  "課金するタイミングみんなの基準は？",
  "シリーズ通して好きなNPCキャラは？",
  "ラスボス倒すまでどのぐらい時間かかりました？",
  "推しキャラのイベント時、石をためておく方法",
  "ランダムイベント、自力で全部埋めた達成感！",
  "B級バグ情報まとめてみませんか？",
  "全年齢向けとは思えない衝撃展開あった！",
  "朝方までやってしまう人手を挙げて！",
  "コメント欄でマッチングしたことある？",

  # ゲームタイトル系
  "○○の最強キャラ議論が過熱してますね（推し理由も！）",
  "○○のエンディング分岐ルートで泣いた…",
  "○○で一番手こずったボスは誰？",
  "○○の隠しダンジョン攻略できた人コツ教えて！",
  "○○のギミックにハマって何度も全滅w",
  "○○の新曲BGMどうだった？",
  "○○はマルチプレイよりソロ派？それともPT派？",
  "○○で最大ダメージ更新した記録晒します！",
  "○○新キャラ実装予想！",
  "○○のガチャで神引き体験した強運自慢！",
  "○○に追加してほしいモード募集",
  "○○のDLCみんな買った？内容どう？",
  "○○スピンオフ出たら買いますか？",
  "○○の一押しバグ映像集まらないかな",
  "○○の世界観は過去作とくらべてどう？",
  "○○で未クリア実績あとひとつ…！アドバイス求ム",
  "○○の「推しPT」おしえて",
  "○○のセリフ回しが神すぎる",
  "○○実況配信でウケた場面教えて",
  "○○公式の神対応話あればぜひ披露して！",

  # バグ・エラー系
  "進行不能バグに遭遇…直し方知ってたら教えて",
  "エラー落ち連発、端末依存？",
  "アプデ後エラー出るようになった人いますか？",
  "珍バグ報告（画像付き歓迎）",
  "運営さんに問い合わせたら返信きた？",
  "公式掲示板見てる人どのぐらい？",
  "ユーザーイベント運営やった人いる？",

  # テクニック・攻略
  "序盤コツコツ進めるコツはここ！",
  "ガチャ爆死報告w",
  "最速クリアランキングやってみませんか？",
  "イベント効率よく回る方法まとめ",
  "難しい章のクリアおすすめ編成",
  "低レベル縛りで遊んでる人いますか？",
  "ミニゲームでハイスコア自慢しよう！",
  "武器強化はどこまでした？",
  "誰のスキル最強説？",
  "一番使ったキャラ愛を語るトピック",
  "ランカー到達したときの喜び！",
  "PvPで勝つための心理戦テクニック",
  "練習しすぎて夢にも出る…！",
  "マルチの役割分担どうしてる？",
  "クリア後やりこみ要素でおすすめは？",
  "周回数カンストした報告求む！",
  "人気のユーザーキャラ投稿紹介所",

  # 共通体験・おもしろエピソード
  "深夜メンバーで盛り上がる謎イベント発生ｗ",
  "初プレイの驚き体験",
  "推し以外にハマった意外なキャラいますか？",
  "昔あった小ネタ・裏技今も使えた！",
  "全キャラクター集めた人何日かかった？",
  "最初の10連でSSR引けるジンクスって本当？",
  "身内用語・流行語大賞ノミネート！",
  "普段絶対やらない行動で激レア称号ゲット",
  "フレンドと交流するタイミングどうしてる？",
  "他作品から来た新規さんいらっしゃいトーク"
]

# === トピック内容に即した投稿のみを抽出 ===
def select_posts_for_topic(topic)
  # タイトル・descからモード判別
  t = topic.title
  pool = []

  if t =~ /バグ|エラー|進行不能|停止/
    pool += POST_BODIES_POOL.select { |x| x =~ /バグ|エラー|進行不能|不具合|珍バグ|落ち|アプデ後|運営|公式/ }
  end
  if t =~ /推し|キャラ|カップル|シナリオ|イベント/
    pool += POST_BODIES_POOL.select { |x| x =~ /推し|キャラ|愛|セリフ|カップル|イベント|演出|台詞|BGM/ }
  end
  if t =~ /ボス|高難易度|対策|攻略|最強|編成|テクニック/
    pool += POST_BODIES_POOL.select { |x| x =~ /攻略|編成|武器|最強|スキル|強化|クリア|コツ|難しい|低レベル|やりこみ|役割/ }
  end
  if t =~ /昔|思い出|裏技|ネタ/
    pool += POST_BODIES_POOL.select { |x| x =~ /思い出|小ネタ|裏技|エピソード|昔|初プレイ/ }
  end
  if t =~ /周回|やりこみ|ランカー/
    pool += POST_BODIES_POOL.select { |x| x =~ /周回|やりこみ|クリア|ランカー/ }
  end
  if t =~ /トピ|雑談|自慢|センス|共感|ノミネート/
    pool += POST_BODIES_POOL.select { |x| x =~ /雑談|トピ|自慢|共感|ノミネート|流行/ }
  end
  if t =~ /フォト|スクリーンショット|画像/
    pool += POST_BODIES_POOL.select { |x| x =~ /画像|フォト|スクリーンショット/ }
  end
  # タイトル以外なら汎用を追加
  pool += POST_BODIES_POOL.sample([POST_BODIES_POOL.size/3, 30].max) if pool.size < 6
  pool.uniq
end

topics.each do |topic|
  # 5-20の投稿数
  topic_posts_src = select_posts_for_topic(topic).shuffle
  post_count = [rand(5..20), topic_posts_src.size].min
  earliest = topic.created_at + 1.hour
  latest = [Time.current - 1.day, earliest + 60.days].min
  post_times = Array.new(post_count) { rand(earliest..latest) }.sort
  post_times.each_with_index do |post_time, idx|
    creator = (topic.members.to_a + [topic.creator]).uniq.sample
    Post.create!(
      topic: topic,
      creator: creator,
      content: topic_posts_src[idx % topic_posts_src.size],
      created_at: post_time
    )
  end
end

#  1. BANユーザー（suspended: true）追加
ban_user = User.create!(
  name: "BANユーザー",
  nickname: "BANさん",
  email: "ban_user@example.com",
  password: "ban_user_password",
  password_confirmation: "ban_user_password",
  profile_text: "管理者により凍結されたユーザーです。",
  suspended: true,
  created_at: Time.current - 2.months
)

#  2. 投稿/コミュニティ未参加ユーザー
no_post_user = User.create!(
  name: "非投稿ユーザー",
  nickname: "ひとうこう",
  email: "no_post_user@example.com",
  password: "no_post_user_password",
  password_confirmation: "no_post_user_password",
  profile_text: "一度も投稿していないユーザーです。",
  suspended: false,
  created_at: Time.current - 1.month
)

puts "Seed完了!"