# == 固定値データ ==
platform_names = %w[
  PC Swotch2 Swotch WilU Wil ゲームチューブ SFC PS5 PS4 PS3 PS2 PS スマホゲーム その他ゲーム機器
]

genre_names = [
  "RPG(ロールプレイングゲーム)",
  "アクションゲーム",
  "アドベンチャーゲーム",
  "シミュレーションゲーム",
  "ストラテジーゲーム",
  "レースゲーム",
  "リズムゲーム",
  "ホラーゲーム",
  "シューティングゲーム",
  "テーブルゲーム"
]

forums_data = [
  {title: "雑談", description: "自分のお気に入りゲームについて会話してみましょう!!"},
  {title: "攻略", description: "ゲームについての攻略情報コミュニティです。"},
  {title: "質問", description: "何かゲームで質問があればコミュニティで聞いてみましょう!!"},
  {title: "要望・提案", description: "ゲームの要望・提案を考えてみましょう。ゲーム開発者が見てくれれば儲けもの・・・"},
  {title: "バグ報告", description: "ゲームのバグについて共有しましょう。"}
]

# == プラットフォーム・ジャンル・フォーラム ==
platforms = platform_names.map { |name| Platform.find_or_create_by!(name: name) }
genres = genre_names.map { |name| Genre.find_or_create_by!(name: name) }
forums = forums_data.map { |forum| Forum.find_or_create_by!(title: forum[:title], description: forum[:description]) }

# == ユーザー ==
jp_names = [
  "佐藤 太郎", "鈴木 健一", "高橋 絵理子", "田中 翼", "渡辺 美咲",
  "伊藤 翔子", "山本 大輔", "中村 麻衣", "小林 直人", "加藤 恵"
]
nicknames = [
  "冒険王", "ゲーマー123", "レトロ達人", "イノベイター", "ワンダー猫",
  "速攻型", "ゆるゲーマー", "スコア職人", "クエスト好き", "ドット絵師"
]
profile_texts = [
  "昔からRPGが大好きで、毎日何かしらゲームしています。新作情報は常にチェック！皆さんと色々なゲームを語り合いたいと思っています。アクションも好きです。",
  "アクションゲームとレースゲームに熱中しています。オンライン対戦も積極的に挑戦！新作ゲームのチェックに余念がなく、フレンドとも情報交換しています！",
  "ストーリー重視のタイトルが好き。よく仲間内で攻略を話し合っています。謎解きやキャラ育成、協力プレイに夢中です。お勧めゲームの話をするのが楽しい。",
  "難易度の高いゲームに挑戦するのが好きです。最近は謎解きやストラテジーに夢中。クリア後のやりこみ要素もしっかり制覇するタイプ！",
  "やりこみ派なので、クリア後要素も全部遊びます！好きなジャンルは幅広いです。自分で攻略法を編み出して仲間に広めることが趣味です！",
  "レトロゲームを集めるのが趣味。SFC～PS1まで幅広くプレイ。昔ながらのコントローラー操作の感覚が大好きです。イベントやコミュニティにもよく参加します。",
  "みんなでワイワイ話す雑談系コミュニティにいつも参加しています。スマホゲームやPCゲームの話題もチェックして対戦しています！",
  "ホラーゲームで肝試し！怖がりですが毎年新作チェックしています。攻略情報も共有しながら、一緒に盛り上がるのが楽しみです。",
  "かわいいキャラ・デザイン重視派。スマホでリズムゲームもよく遊びます。グラフィックやUIにもこだわりがあり、おしゃれなゲームが好きです。",
  "新しい要素と古き良きゲームの融合が好き。隠し要素や裏技にも強いです。ゲーム業界のトレンドにも敏感で、常に最新情報を収集しています。"
]

users = []
10.times do |i|
  email_num = (i * 1111).to_s.rjust(4, "0")
  email = "#{email_num}@example.com"
  password_num = (i * 111111).to_s.rjust(6, "0")
  users << User.find_or_create_by!(
    email: email
  ) do |u|
    u.name = jp_names[i]
    u.nickname = nicknames[i]
    u.password = password_num
    u.profile_text = profile_texts[i]
    u.suspended = false
  end
end

# == レビュー（本文200文字以上）==
review_items = []
users.each_with_index do |user, idx|
  6.times do |i|
    title = "【#{user.nickname}レビュー#{i+1}】#{platforms[(idx+i)%platforms.size].name}-#{genre_names[(idx+i)%genre_names.size]}編"
    content = "このゲームで印象に残ったのはステージごとに変化する雰囲気と音楽です。チュートリアルも充実していて初心者でも手軽に遊べます。戦闘やミニゲームなど、どの要素も独自性が高く、特に仲間キャラとの連携プレイが楽しかったです。隠しアイテム探しやクリア後のお楽しみ要素も豊富で、何度も再プレイしたくなる作品でした。全体としてとても高評価です。" + ("#{user.nickname}のおすすめポイント: " if i==0).to_s # タイトル被り防止（レビューの文章は一部重複可）
    review = Review.find_or_create_by!(
      user: user,
      title: title[0...100]
    ) do |r|
      r.platform = platforms[(idx + i) % platforms.size]
      r.genre = genres[(idx + i) % genres.size]
      r.rating = (0.5 + rand * 4.5).round(1)
      r.play_time = "#{((i+1) * 3 + idx * 2) % 100}"
      r.content = content.strip
      r.approved = true
      r.star = (0.5 + rand * 4.5).round(1)
    end
    review_items << review
  end
end

# == コメント（バリエーション30通り/ランダム, 50字以上200字以内。前置詞等無し）==
review_comment_variations = [
  "ボス戦の演出が最高で感動しました。仲間との協力がうまくいったときの達成感がたまりません。",
  "謎解きの難易度がちょうどよく、飽きずに最後まで遊べました。次作も期待しています。",
  "タイムアタックが面白くて何度も挑戦したくなります。報酬アイテムも豪華で嬉しいです。",
  "マップの作り込みが素晴らしく探索が楽しかったです。隠しステージがもう少し欲しい。",
  "アップデートでシステムが改善されてより快適になりました。運営の対応に感謝です。",
  "イベント限定キャラが強くて戦略が広がりました。ガチャの演出も凝っていて満足です。",
  "リーダースキルの使いどころが難しいですが、慣れると逆転が狙えて面白かったです。",
  "ストーリー展開に驚きが多く続きが楽しみです。推しキャラの活躍が見れて嬉しい。",
  "ミニゲームの完成度が高くて、ついつい本編そっちのけで遊んでしまいました。",
  "敵キャラのデザインがユニークで新鮮でした。強さのバランスも良いです。",
  "課金アイテムの価格が良心的でありがたい。無課金派でも十分遊べるゲームです。",
  "オンライン対戦が盛り上がって友達と何度もプレイしました。ランキングも狙いたいです。",
  "バグが減って動作が安定してきたので安心して遊べるようになりました。",
  "初心者向けの攻略サイトが充実していて助かりました。公式情報も定期的にチェックしています。",
  "遊び方の幅が広く、やりこみ要素もたくさんあります。しばらく飽きそうにありません。",
  "ボイス付き演出が豪華でキャラへの愛着が増しました。フルボイスで感情移入できました。",
  "他のユーザーからの情報共有が役立ちます。コツを聞いてチャレンジ方法が変わりました。",
  "マルチプレイで協力する楽しさがあり、仲間との絆が深まりました。",
  "最新イベントにずっと夢中になっていました。期間限定ステージが特に面白かったです。",
  "スタートダッシュ報酬が豪華で序盤から遊びやすいです。初心者でも安心。",
  "推理パートでじっくり考えた甲斐があって、無事クリアできました。",
  "期間限定衣装が可愛くて集めるのが楽しい。もっと種類が欲しいです。",
  "ログインボーナスの内容が毎日変わるので、続けて遊ぶモチベーションになります。",
  "連携技の演出が派手で爽快感抜群。友達とタイミングを合わせて盛り上がりました。",
  "新しい武器やアイテムが追加されて戦略に幅が出ました。",
  "仲間キャラの掛け合いが楽しくて物語がどんどん盛り上がる展開でした。",
  "やり込み派でも満足できるほどのボリュームがあり、全てクリアするのが大変でした。",
  "ステージクリア後に追加されるモードが面白くて何度も楽しめました。",
  "オープンワールド風のマップで自由度の高さを感じました。",
  "対戦ルールがしっかりしているのでフェアに戦えます。"
]

like_pairs = []
review_items.each_with_index do |review, idx|
  users.each_with_index do |c_user, cidx|
    is_positive = (cidx + idx).even? # バリエーションのため
    comment_text = review_comment_variations[(idx*users.size + cidx) % review_comment_variations.size]
    rc = ReviewComment.find_or_create_by!(
      user: c_user,
      review: review
    ) do |comment_obj|
      comment_obj.comment = comment_text[0..199]
    end
    if is_positive
      Like.find_or_create_by!(user: c_user, review: review)
      like_pairs << [c_user, review.user]
    end
  end
end

# == フォロー（いいねしたユーザーはレビュー作成者をフォロー）==
like_pairs.uniq.each do |liker, author|
  next if liker == author
  Follow.find_or_create_by!(follower: liker, followed: author)
end

# == トピック（本文200文字以上）==
topic_items = []
users.each_with_index do |user, idx|
  2.times do |i|
    forum = forums[(idx + i) % forums.size]
    t_title = "【#{user.nickname}トピック#{i+1}】#{forum.title}-交流コミュニティ-#{user.name}"
    t_desc = "ゲームに関する情報交換や質問・要望を自由に投稿してください。攻略法やおすすめキャラ、バグ報告など様々なジャンルが話題になります。皆さんの経験談や新しい発見を積極的に共有し、より多くのユーザーと有益なコミュニケーションができる場所にしたいです。初心者から上級者までみんなで楽しみましょう。"
    topic = Topic.find_or_create_by!(
      forum: forum,
      creator: user,
      title: t_title[0...100]
    ) do |t|
      t.description = t_desc.strip
      t.locked = false
      t.posts_count = 0
      t.views_count = rand(1..100)
      t.pinned = i.zero?
    end
    topic_items << topic

    # メンバー：5人
    member_ids = users.sample(5).map(&:id)
    member_ids.each do |uid|
      TopicMembership.find_or_create_by!(
        topic: topic,
        user_id: uid
      ) do |tm|
        tm.status = "approved"
      end
    end

    # == チャット(post) バリエーション（30セット、会話内容と返答）==
    chat_variations = [
      ["攻略法で苦戦している人はいますか？何かコツがあれば教えてほしいです。","自分はアイテムを有効活用することでクリアしやすくなりました。"],
      ["新しいアップデートの内容についてどう思いますか？","個人的にはシステム改修でだいぶ快適になったと思います。"],
      ["推しキャラのおすすめ理由を知りたいです。","攻撃力が高いのと、スキルの発動タイミングが絶妙なので重宝しています。"],
      ["バグを見つけてしまいましたがみなさんは同じ現象に遭遇していますか？","こちらも同じような不具合が発生したので運営に報告しました。"],
      ["イベント限定ステージが難しいので突破方法を相談したいです。","仲間と協力プレイするとクリアしやすかったです。おすすめです。"],
      ["アイテムの効果が変更された気がするのですが気付きましたか？","ダメージ軽減効果が強化されているように思います。"],
      ["初回クリア報酬が豪華で嬉しいですね。みなさんは何をゲットしましたか？","レアキャラをゲットできてテンションあがりました。"],
      ["ガチャの確率が変わったように感じるのですが本当ですか？","公式から発表があったので少しだけ変更されています。"],
      ["期間限定衣装について情報ほしいです。条件を満たすの大変でした。","達成するとボーナスアイテムも貰えるのでチャレンジする価値ありです。"],
      ["序盤に最優先で育てるべきキャラを教えてほしいです。","防御力の高いキャラから強化するのがおすすめです。"],
      ["最新のランキング上位プレイヤーの使っている編成に興味があります。","SNSで公開された情報によれば回復重視が主流みたいです。"],
      ["周回プレイするとどんなメリットがありますか？","経験値効率が良くなり、アイテム集めが捗ります。"],
      ["協力プレイで役立つテクニックを教えてください。","ボイスチャットで作戦を共有すると連携しやすいです。"],
      ["新ステージが追加されましたが攻略は進んでいますか？","ボス戦を突破できたので今度攻略記事を書こうと思っています。"],
      ["特定キャラが強すぎる件についてどう思いますか？","バランス調整が次回で入るようなので様子見しています。"],
      ["マップが広くて探索に時間がかかります。おすすめルートありますか？","中央ルートから行くとイベントを逃しにくいです。"],
      ["コンテニューのタイミング迷っています。どう使えば効果的ですか？","ラスボス戦まで温存するのがおすすめです。"],
      ["ストーリーで泣ける場面がありました。皆さんはどこが一番感動しましたか？","中盤の仲間との別れのシーンが印象的でした。"],
      ["強化アイテムの入手方法がわかりません。どこで手に入りますか？","高難易度ステージの報酬で集められます。"],
      ["毎日ログインボーナスを欠かさず集めています。皆さん使い道は何ですか？","主にガチャチケットに変換しています。"],
      ["課金する価値があるポイントはどこですか？","衣装やキャラのコレクション目的で課金しています。"],
      ["協力イベント参加者を募集しています。誰か一緒にプレイしませんか？","興味あります！ぜひ仲間に入れてください。"],
      ["定期開催の大会に挑戦したいですが、どのくらいの難易度でしょうか？","上位入賞は難しいですが参加するだけでも楽しいです。"],
      ["フルボイス化されたストーリーを堪能しています。皆さんの感想を教えてください。","没入感が強くて物語に引き込まれました。"],
      ["ステージのギミックに苦戦しています。どうやって突破していますか？","回避タイミングを覚えると攻略しやすくなります。"],
      ["再登場したキャラは以前より強くなっている気がします。","スキル追加でパワーアップしたそうです。"],
      ["好きなゲーム音楽について語りたいです。みなさんのお気に入りは？","オープニングの曲が特に好きです。"],
      ["近日公開予定の新コンテンツに期待しています。詳細情報知っている方いますか？","開発ブログで公式情報が少しだけ出ていました。"],
      ["フレンド機能が充実してきましたね。交流の幅が広がったと思います。","メッセージ機能も便利でもっと使ってみたいです。"],
      ["次回メンテナンスで何が改善されると思いますか？","マッチングの快適化があるらしいので楽しみです。"]
    ]

    # 10セットずつ選択
    selected_sets = chat_variations.sample(10)
    selected_sets.each do |q, a|
      member = users.find { |u| member_ids.include?(u.id) }
      Post.find_or_create_by!(
        topic: topic,
        creator_id: member.id,
        content: q[0..200],
        edited: [true, false].sample
      )
      member2 = users.find { |u| member_ids.include?(u.id) && u.id != member.id }
      Post.find_or_create_by!(
        topic: topic,
        creator_id: member2 ? member2.id : member.id,
        content: a[0..200],
        edited: [true, false].sample
      )
    end
  end
end

puts "Seed完了!"