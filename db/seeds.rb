# == 管理者アカウント ==
Admin.find_or_create_by!(email: "admin@example.com") do |admin|
  admin.password = "password"
  admin.password_confirmation = "password"
end

# == 固定値データ ==
platform_names = %w[
  PC Swotch2 Swotch WilU Wil ゲームチューブ SFC PS5 PS4 PS3 PS2 PS スマホゲーム その他ゲーム機器
]

genre_names = [
  "RPG(ロールプレイングゲーム)",
  "アクションゲーム",
  "アドベンチャーゲーム",
  "シミュレーションゲーム",
  "ストラテジーゲーム",
  "レースゲーム",
  "リズムゲーム",
  "ホラーゲーム",
  "シューティングゲーム",
  "テーブルゲーム"
]

forums_data = [
  {title: "雑談", description: "自分のお気に入りゲームについて会話してみましょう!!"},
  {title: "攻略", description: "ゲームについての攻略情報コミュニティです。"},
  {title: "質問", description: "何かゲームで質問があればコミュニティで聞いてみましょう!!"},
  {title: "要望・提案", description: "ゲームの要望・提案を考えてみましょう。ゲーム開発者が見てくれれば儲けもの・・・"},
  {title: "バグ報告", description: "ゲームのバグについて共有しましょう。"}
]

# == プラットフォーム・ジャンル・フォーラム ==
platforms = platform_names.map { |name| Platform.find_or_create_by!(name: name) }
genres = genre_names.map { |name| Genre.find_or_create_by!(name: name) }
forums = forums_data.map { |forum| Forum.find_or_create_by!(title: forum[:title], description: forum[:description]) }

# == ユーザーデータ（サンプル20名） ==
user_profiles = [
  "幼い頃からゲームが好きで、RPGやアクション、音楽ゲームまで幅広く楽しんでいます。最近のお気に入りは協力プレイが熱いタイトル！休日は友人とオンラインで盛り上がるのが至福です。",
  "攻略情報の発信やレビュー執筆が趣味。新作タイトルは発売日に必ずチェックし、感想をSNSに投稿しています。オフラインイベントにもよく参加します！",
  "まったり系プレイヤー。仕事終わりや寝る前に一息つくための癒やしとして、スローライフゲームやパズルゲームを楽しんでいます。たまに実況配信もしています。",
  "対人戦（PvP）が大好き！格闘ゲームを中心にランキング上位を目指して日々腕を磨いています。大会への参加経験もあり。",
  "レトロゲーム愛好家です。ファミコンやSFC時代の名作を集めて20年。思い出と共にレビューを書いています。",
  "家族みんなでワイワイ楽しめるゲームが好き。小さい子供でも遊べるタイトルを紹介する記事を書いています。親子ゲーマー。",
  "ホラーゲーム・謎解きゲーム特化。怖いけどやめられない、そんな名作を見つけるのが生きがいです。おすすめ募集してます！",
  "グラフィック・音楽・ストーリー全てをじっくり味わいたい派。美麗なRPGを中心にレビューを書いています。",
  "毎日ログインしてコツコツ型のスマホゲームを楽しんでいます。ガチャやイベント攻略のアドバイスも書いています。",
  "レビューよりもコミュニティでみんなと会話するのが楽しみ。ゲームの話題なら何でも大歓迎！",
  "ゲーム実況もたまにしているライトゲーマー。気になるタイトルはすぐに手を出し、その勢いでレビューを投稿しています。",
  "音ゲー命！新曲フルコンボを目指し、ハイスコア更新に燃えています。音楽ゲームの魅力を伝えたいです。",
  "シミュレーションゲーム専門。歴史・経営・都市作り系が大好物。じっくり時間をかけてプレイ、丁寧にレビューします。",
  "ゲーム内でフレンドを作るのが得意。初心者の手助けやギルド運営にも積極的です。みんなでワイワイ派。",
  "新作インディーゲーム漁りが趣味。毎週新しいゲームを買うのを楽しみにしています。意外な名作を発掘して紹介しています。",
  "自作ゲーム開発者。裏方としての視点でレビューや改善点を指摘しています。開発者同士の交流も大事にしています。",
  "懐かしの名作を再プレイして発見した新たな魅力を語っています。昔の思い出と共にレビューを書けるのが幸せ。",
  "家族と協力・対戦できるパーティーゲームに目がないです。親戚が集まったときはいつもゲーム大会！",
  "RPGでストーリーを深く楽しむ派。感動したシーンやキャラクターの魅力を語る長文レビューに定評があります。",
  "子どもたちと一緒に楽しめるゲームを探しています。教育的な要素やコミュニケーションが取れるゲームを中心に遊んでます。"
]

user_count = 20
users = []
user_count.times do |i|
  # i=0が一番古い、i=19が今日
  # 1年をuser_count等分して、さらに±数日のランダムを混ぜる
  base_time = (1.year * (user_count - 1 - i) / (user_count - 1)) # 秒数で
  # ±7日程度の小ランダム追加
  ripple = rand(-7.days..7.days)
  created = Time.current - base_time + ripple

  users << User.create!(
    name: "ユーザー#{i}",
    nickname: "にっくねーむ#{i}",
    email: "example#{i}@example.com",
    password: "example#{i}",
    password_confirmation: "example#{i}",
    profile_text: user_profiles[i],
    suspended: false,
    created_at: created
  )
end

require 'securerandom'

# --- プラットフォーム・ジャンルのセットアップ ---
platforms = Platform.all.to_a
genres    = Genre.all.to_a
users     = User.all.to_a

# --- ゲームタイトルネタ ---
game_titles = [
  "星降る冒険譚サンクタリウム",
  "ミラージュ・クロノス",
  "孤島のリミナリス",
  "レゾナンス・オブ・ダークネス",
  "セレスティアの誓約",
  "ウィッチズ・オルゴール",
  "機巧兵団スチームギア",
  "ダイブ・トゥ・マナリア",
  "クローバー・ラビリンス",
  "エターナル・ソーン",
  "銀嶺のソードマスター",
  "フェイブル・コンチェルト",
  "幻影探偵シャドウコード",
  "アルカナ・ルーレット",
  "暁のインビジブル",
  "サモナーズ・フロンティア",
  "ドリームシフターズ",
  "マグネット・インサニティ",
  "ジオラマ・ジェネシス",
  "ノクターン・デスペランサ",
  "ブラックサイト：ラグランジュ",
  "ワンダースフィア・クエスト",
  "ラストシーカー：転生の書",
  "ヴァルハラ・ブレイブリー",
  "オメガリフト・サーガ"
]

# --- レビュー本文（200文字以上でバリエーション豊富に） ---
review_bodies = [
  "本作は壮大なファンタジーワールドを見事に構築しており、ストーリー演出やキャラクター同士の細やかな交流が素晴らしい。グラフィックやBGMも要所で場面を盛り上げ、冒険心を思い出させてくれる作品。バトルは戦略性が高く、仲間キャラとの連携を考える楽しみがある。物語終盤はプレイヤーの選択で結末が大きく変化し、何度も周回したくなる中毒性も魅力。",
  "本作にはリアルタイムバトルとアドベンチャー要素が融合しており、初めは手応えの強さに圧倒されますが、慣れると奥深い戦略性に魅了されました。物語も王道ながら意外な展開もあり、一気にクリアしてしまいました。マルチエンディングのおかげで、周回プレイも飽きません。特にエンディング選択前の伏線回収が秀逸です。",
  "タイムトラベルをテーマにした物語で、ゲーム全体に漂う不思議な雰囲気がクセになる。謎解き要素も盛り込まれており、先の読めない展開に夢中でプレイしてしまった。グラフィックは近未来的で洗練されているが、一部操作性で戸惑う場面も。ボリュームも十分で、エンディング後に解放されるサブクエストも豊富。トータルで満足度の高い一本。",
  "孤島でサバイバル生活を送りながら少しずつ真相に迫っていく展開が秀逸。緻密な資源管理や、島民との交流イベントがゲーム進行の鍵を握る。サブキャラクターも個性的で飽きさせない。グラフィックはやや素朴だがBGMが心地良い。探索好きにも満足できる隠しエリアやミニゲームもあり、何度もプレイしたくなる。",
  "本格ダークファンタジーRPG。魔物との緊張感あるバトルと重厚な世界観が印象的だった。主人公が背負う運命や仲間たちのドラマにも引き込まれ、物語を追うだけでも夢中になってしまう。一部UIにわかりにくさを感じたが、やり込み要素やチャレンジモードもあり、長く楽しめる一作。",
  "空に浮かぶ王国を舞台に、謎に包まれた伝説を紐解いていくシナリオが見事。キャラクターボイスや演出も凝っており、物語の没入感はシリーズ随一。ボス戦の難易度はやや高めだが、クリアしたときの達成感は格別。サブイベントやミニゲーム要素も充実していて、つい全実績を集めたくなる。",
  "魔女が奏でる不思議な旋律がテーマの一風変わったパズルアドベンチャー。技巧的なパズルが連続するが理不尽ではなく、クリア時の達成感が気持ちいい。ビジュアルや音楽も独創的で雰囲気抜群。ストーリーは控えめながら深読みが可能で、余韻が残るラストシーンも印象的。",
  "スチームパンク世界での大規模戦が楽しいシミュレーションゲーム。ユニットの育成や装備集め、マップ戦略の幅が非常に広く、自分だけの軍隊を作る喜びがある。オンライン要素ではプレイヤー同士の知略対決も白熱。操作に少し慣れが必要だが、ハマるとやめ時が見つからない中毒性がある。",
  "魔力に溢れる大地を舞台に、ダイブして冒険するアクションRPG。多彩なスキルや装備切り替えが可能で、戦闘のテンポも良い。ストーリーもテンポよく進み、寄り道要素やキャラの掘り下げイベントも魅力。派手なエフェクトが多用されているが動作は軽快。一気にクリアしてしまう面白さがあった。",
  "かわいいクローバーを集めて進む迷宮探索ゲーム。パズル要素もあり、頭を悩ませる仕掛けが随所に登場する。グラフィックはポップで親しみやすく、子供から大人まで楽しめる。協力プレイでは家族や友人とワイワイ盛り上がった。本編クリア後のチャレンジステージも歯ごたえ抜群。",
  "ダークファンタジーにSFの要素が加わった特殊なRPG。物語や世界観が独特で、好みが分かれるかもしれないが刺さる人にはとことん刺さる作品。バトルの難易度は高めで、繊細な育成が求められる。ストーリーの謎解き要素も奥深かった。クリアまで30時間以上かかったが、その分の満足感は大きい。",
  "氷に覆われた世界を舞台に、剣士として生き残りをかけるサバイバル＆バトルゲーム。仲間キャラの成長や武器カスタマイズが楽しい。マルチエンドに対応しており、何度も遊びたくなる要素満載。グラフィックは超美麗で、音楽も壮大だった。雪原の中で見つけた隠しシナリオが涙ものでした。",
  "音楽と謎解きを融合させた新感覚アドベンチャー。随所に散りばめられた楽曲やBGMがプレイ体験を彩ってくれる。操作性も直感的で遊びやすい。エンディングまであっという間だったが、その短さを感じさせない濃密な内容だった。おしゃれな演出も印象的で、癒やされたい人におすすめ。",
  "ハードボイルドな雰囲気漂う探偵物。ストーリー展開のスピードや選択肢の多さが魅力的。登場人物の背景も複雑で、考察好きにはたまらない。推理パートの難易度は適度。グラフィックも独特で、少しクセはあるが没入感は強い。エンディング分岐も豊富で長く遊べる。",
  "カードゲームとサイコロを融合した斬新なルールが印象的。高速で展開するバトルが癖になる。カード集めやデッキ構築も楽しみつつ、運要素と戦略性のバランスが絶妙。ローカル対戦も盛り上がった。短い時間でさくっと遊べるが極め出すと奥が深く、やり込んでしまう。",
  "ステルスアクションが得意なプレイヤーにおすすめしたい一作。夜の都市を舞台に、様々なギミックを駆使して任務を遂行。敵AIが賢く、毎回異なる攻略パターンを考える楽しさがある。グラフィックも暗めで雰囲気重視。難易度は高めだが達成感が大きい。",
  "召喚獣たちと契約し、世界を救うべく冒険するRPG。壮大なストーリーや個性豊かな仲間たちのやり取り、迫力満点の召喚バトル。物語のテンポも良く、サブイベントも豊富。本編をクリアした後もやり込める要素が多い。定期的にイベント追加もあるみたい。",
  "夢の中の世界を旅するアドベンチャー。ユニークなキャラクターや不可思議な空間が連続し、飽きずに進められる。謎解きも斬新で視覚的な演出も多彩。ストーリー展開はやや難解だったが、自分で解釈できる楽しさがあった。操作性は良好で、全体的に高評価。",
  "磁石をテーマにした物理パズルアクション。ギミックのユニークさと操作の直感性が光る。各ステージごとに新しいアイディアが投入され、最後まで飽きずに楽しめた。難易度の上昇バランスも絶妙。タイムアタック要素も充実しているので、繰り返し遊ぶ楽しさがあった。",
  "街づくりと経営シミュレーションが合体した新感覚タイトル。建物や資源の配置バランスを見極める戦略性が奥深い。キャラクターの生活も観察できて癒やされる。難易度は程よく、初心者から上級者まで長く遊べる印象。BGMも穏やかでプレイ中のストレスが少ない。",
  "夜の都市で繰り広げられるサスペンス・ノベルゲーム。複数視点で語られるストーリーの重厚さに引き込まれた。選択肢によって分岐する展開が緊張感あり。BGMや演出も雰囲気抜群で、何度もエンディングを目指してしまう。",
  "異世界転生シミュレーションとして革新的な作品。サブイベントの豊富さや、自由度の高い育成がとても楽しい。UIデザインも見やすく長時間プレイしても疲れません。エンディングルートの多さには驚きました。",
  "協力マルチプレイでの連携が勝敗を左右する斬新なバトルシステム。フレンドと一緒にプレイすることで楽しさ倍増です。独自のマッチング機能もストレスフリーで快適でした。初心者でも安心して入れる設計。",
  "ノスタルジックなドット絵と現代的なシステムが絶妙に融合する冒険譚。登場キャラの背景設定が深く、共感できるストーリー展開でした。ちょっとした不満点もあるが、それすら味に感じる名作。",
  "リアルタイムストラテジーとしての完成度が高い。緻密なマップ設計やユニットバランスが絶妙です。世界中のプレイヤーと対戦することで、自分の成長も感じられる良いタイトル。",
  "ストーリーと音楽の調和が心に残る感動作。グラフィックも美麗で、最後までプレイした時の充実感がすごかった。ぜひ続編を望みたい。",
  "全体的にハイクオリティ。ストーリー、キャラ、サウンド、バトルのどれを取っても平均以上。数々の名シーンが心に残る珠玉の一作。",
  "戦闘システムが独特で、慣れるまでは苦労しましたが、理解を深めるほどに面白くなりました。途中若干難易度は高いですが丁寧なチュートリアルもあり、初心者でも挑戦できる作品です。"
]

# --- レビュー星評価リスト ---
star_values = (1..10).map { |n| n * 0.5 } # 0.5, 1.0, ... 5.0
# shuffle用に事前にstar値を割り当て
star_map = game_titles.zip(star_values.shuffle).to_h

# --- プレイ時間生成用 ---
def generate_play_time_for(star, body)
  case
  when star > 4.0 then rand(45..90).to_s # 高評価＝長め
  when star > 3.0 then rand(30..50).to_s
  when star > 2.0 then rand(15..30).to_s
  when star > 1.0 then rand(5..20).to_s
  else rand(1..10).to_s
  end
end

# 1:1にするために全カテゴリシャッフル
platforms_cycle = platforms.cycle
genres_cycle    = genres.cycle

reviews = []
users.each_with_index do |user, i|
  # 各ユーザーに2件以上になるよう、バラけさせる
  n_reviews = [2, rand(3..4)].sample
  n_reviews.times do 
    # タイトル/本文一意消費
    title = game_titles.shift
    body  = review_bodies.shift
    star  = star_map[title] || star_values.sample
    play_time = generate_play_time_for(star, body)
    platform = platforms_cycle.next
    genre    = genres_cycle.next

    # ユーザーのcreated_at以降〜今日−1日まででランダムな日時を生成
    review_created_at = rand(user.created_at..(Time.current - 1.day))
    review = Review.create!(
      user: user,
      title: title,
      content: body,
      platform: platform,
      genre: genre,
      rating: star,
      star: star,
      play_time: play_time,
      approved: true
      created_at: review_created_at
    )
    reviews << review
    break if game_titles.empty?
  end
  break if game_titles.empty?
end

# 全プラットフォーム/ジャンルが一度は選ばれているかチェック（漏れがあれば割り当てする）
remaining_platforms = platforms - reviews.map(&:platform)
remaining_genres = genres - reviews.map(&:genre)
remaining_platforms.each_with_index do |plat, idx|
  review = reviews[idx % reviews.size]
  review.update(platform: plat)
end
remaining_genres.each_with_index do |gen, idx|
  review = reviews[idx % reviews.size]
  review.update(genre: gen)
end

# --- レビューコメント ---
review_comment_bodies = [
  { body: "主人公のキャラクター性が最高！ストーリーに感動して涙が出ました。", score: 0.9 },
  { body: "音楽とグラフィックの組み合わせが美しいです。夢中になれました！", score: 0.8 },
  { body: "戦闘が難しすぎて挫折しそう…でもやり応え充分です。", score: -0.4 },
  { body: "操作性が思ったより快適で遊びやすい。つい長時間やってしまう。", score: 0.7 },
  { body: "ストーリーが途中から難解でついていけなくなりました。人を選ぶゲームかも。", score: -0.7 },
  { body: "協力プレイでの盛り上がり方が最高！友達と遊ぶのが楽しい一本でした。", score: 1.0 },
  { body: "エンディングが予想外で驚きました。", score: 0.6 },
  { body: "一部バランス調整が甘く感じる場面があり、そこだけ惜しい。", score: -0.6 },
  { body: "サブイベントが豊富で寄り道が楽しい。", score: 0.5 },
  { body: "難易度が高く、最初は苦戦しますがクリア時の達成感は格別です。", score: 0.4 },
  { body: "アイテム収集要素がやり込み好きにはたまりません。", score: 0.3 },
  { body: "グラフィックはやや粗いけど内容は良作です。", score: 0.2 },
  { body: "説明不足な点が多く初心者には少し難しいかも。", score: -0.8 },
  { body: "ストレス発散に最適な爽快アクションでした！", score: 0.9 },
  { body: "オンライン要素があればもっと楽しめたと思う。", score: -0.5 },
  { body: "ロード時間が長い点が唯一残念。", score: -0.9 },
  { body: "キャラどうしの会話が面白く物語にのめりこめました。", score: 0.5 },
  { body: "新規プレイヤーにも優しい設計で好印象です。", score: 0.8 },
  { body: "グラフィックは美しいが難しすぎて途中でやめてしまった。", score: -0.6 },
  { body: "課金しなくても十分楽しめる良心的なゲームです。", score: 0.6 },
  { body: "アップデートごとにバランスが崩れてしまう。", score: -0.7 },
  { body: "エンドロールで泣いてしまいました。", score: 0.8 },
  { body: "音楽が耳に残る名曲揃いです。サントラ欲しい。", score: 0.7 },
  { body: "コミュニティの雰囲気がとても良いので長く続けられそうです。", score: 1.0 },
  { body: "良いアイディアだが実装が甘い印象を受けた。", score: -0.3 },
  { body: "いろいろなイベントが用意されていて嬉しい。", score: 0.4 },
  { body: "バトルのシステムが単調で飽きてしまった。", score: -0.5 },
  { body: "ゲームを通して友達が増えた！", score: 0.6 },
  { body: "バグが多くてイライラした。", score: -1.0 },
  { body: "やり込み要素が多く、長く楽しめるのが良いです。", score: 0.8 },
  { body: "ストーリーに深みがあり大人も楽しめる作品。", score: 0.7 },
  { body: "最初の難関を乗り越えれば楽しくなってくる。", score: 0.3 },
  { body: "キャラクターの台詞がネタっぽく好みに合わなかった。", score: -0.2 },
  { body: "ユーザーインターフェースが直感的で使いやすい。", score: 0.5 },
  { body: "エラー落ちが頻発したのが残念だった。", score: -0.9 },
  { body: "ラスボス直前で詰んだけど、攻略情報のおかげで無事クリア。", score: 0.4 },
  { body: "アップデートで新機能が増えさらに面白くなりました。", score: 0.6 },
  { body: "ストーリーは良いけど、戦闘のテンポが悪かった。", score: -0.4 },
  { body: "吹き替え声優が豪華で聴きごたえがある。", score: 0.6 },
  { body: "操作説明が雑で最初は苦戦した。", score: -0.8 },
  { body: "昔懐かしい雰囲気で童心に帰れる作品！", score: 0.9 },
  { body: "全体的に難易度が高めだと感じました。", score: -0.5 }
]

reviews.each do |review|
  comment_bodies_sample = review_comment_bodies.shuffle.first(5)
  # 必ずポジティブ/ネガティブ両方入るようにする
  pos_comment = review_comment_bodies.select{|h| h[:score] > 0}.sample
  neg_comment = review_comment_bodies.select{|h| h[:score] < 0}.sample
  comments_src = ([pos_comment, neg_comment] + comment_bodies_sample).uniq.first(5)
  used_users = ([review.user] + users).uniq.shuffle.first(6)
  comments_src.each_with_index do |comment_info, idx|
    commenter = (used_users - [review.user]).sample
    # レビューのcreated_at以降〜今日−12時間まででランダムな日時を生成
    comment_created_at = rand(review.created_at..(Time.current - 12.hours))
    c = ReviewComment.create!(
      user: commenter,
      review: review,
      comment: comment_info[:body],
      score: comment_info[:score]
      created_at: comment_created_at
    )
    # ポジティブなら「いいね」＆作成者をフォロー
    if comment_info[:score] > 0
      Like.find_or_create_by!(user: commenter, likeable_id: review.id)
      if commenter != review.user
        Follow.find_or_create_by!(follower: commenter, followed: review.user)
      end
    end
    used_users.delete(commenter)
  end
end



puts "Seed完了!"